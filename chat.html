<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoknowGram PRO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a1f24;
            --bg-tertiary: #252a31;
            --accent-primary: #00d4aa;
            --accent-secondary: #0099ff;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --danger: #ff4444;
            --success: #00c851;
            --warning: #ffbb33;
            --border-color: #2d3748;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 320px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .user-info h3 {
            font-size: 1.1em;
            margin-bottom: 4px;
        }

        .user-status {
            font-size: 0.8em;
            color: var(--accent-primary);
        }

        .header-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .action-btn {
            padding: 6px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8em;
        }

        .action-btn:hover {
            background: var(--bg-tertiary);
        }

        .search-container {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .chats-section {
            flex: 1;
            overflow-y: auto;
        }

        .section-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .add-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            cursor: pointer;
            font-size: 1.2em;
        }

        .chat-list {
            display: flex;
            flex-direction: column;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }

        .chat-item:hover {
            background-color: var(--bg-tertiary);
        }

        .chat-item.active {
            background-color: var(--accent-primary);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .chat-last-message {
            font-size: 0.8em;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 15px 25px;
            background-color: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-info-main {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-title {
            font-size: 1.2em;
            font-weight: 600;
        }

        .chat-status {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .control-btn:hover {
            background: var(--bg-primary);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background-color: var(--bg-primary);
        }

        .message {
            background-color: var(--bg-secondary);
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 70%;
            word-wrap: break-word;
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease-out;
        }

        .message.own {
            background-color: var(--accent-primary);
            align-self: flex-end;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .sender-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-time {
            font-size: 0.7em;
            color: var(--text-secondary);
            margin-left: 10px;
        }

        .file-message {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 15px;
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .file-icon.image { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .file-icon.video { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .file-icon.audio { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .file-icon.document { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .file-icon.archive { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .file-icon.other { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-action-btn {
            padding: 6px 12px;
            background: var(--accent-primary);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.8em;
        }

        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .system-message {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            padding: 10px;
            background-color: rgba(0, 212, 170, 0.1);
            border-radius: 8px;
            margin: 0 auto;
            max-width: 80%;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .typing-indicator {
            font-style: italic;
            color: var(--text-secondary);
            padding: 10px;
        }

        .input-area {
            padding: 20px;
            background-color: var(--bg-tertiary);
            border-top: 1px solid var(--border-color);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            line-height: 1.4;
            font-family: inherit;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .icon-btn:hover {
            background: var(--accent-primary);
        }

        .send-btn {
            width: 40px;
            height: 40px;
            background: var(--accent-primary);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .send-btn:hover {
            background: #00c49a;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .user-selector {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
        }

        .user-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .user-option:last-child {
            border-bottom: none;
        }

        .user-option:hover {
            background: var(--bg-tertiary);
        }

        .user-option.selected {
            background: var(--accent-primary);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        /* –û–∫–Ω–æ –∑–≤–æ–Ω–∫–∞ */
        .call-window {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .call-window.active {
            display: flex;
        }

        .call-header {
            padding: 20px;
            background: var(--bg-tertiary);
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .call-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            position: relative;
        }

        .video-container {
            width: 100%;
            max-width: 800px;
            aspect-ratio: 16/9;
            background: var(--bg-secondary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--accent-primary);
            position: relative;
            overflow: hidden;
        }

        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 2px solid var(--accent-primary);
            overflow: hidden;
        }

        .local-video video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            color: var(--text-secondary);
            font-size: 1.2em;
            text-align: center;
        }

        .call-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .call-controls-bottom {
            padding: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
            background: var(--bg-tertiary);
        }

        .call-control-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: var(--bg-secondary);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .call-control-btn:hover {
            transform: scale(1.1);
        }

        .call-control-btn.mute {
            background: var(--danger);
        }

        .call-control-btn.video-off {
            background: var(--danger);
        }

        .call-control-btn.screen-share {
            background: var(--warning);
        }

        .call-control-btn.end-call {
            background: var(--danger);
        }

        /* –û–∫–Ω–æ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞ */
        .incoming-call-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .incoming-call-modal.active {
            display: flex;
        }

        .incoming-call-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--accent-primary);
        }

        .incoming-call-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .accept-call-btn {
            padding: 12px 24px;
            background: var(--success);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        .reject-call-btn {
            padding: 12px 24px;
            background: var(--danger);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent-primary);
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <h3 id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                        <div class="user-status">‚óè –æ–Ω–ª–∞–π–Ω</div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="action-btn" id="createGroupBtn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                    <button class="action-btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫..." id="searchInput">
            </div>

            <div class="chats-section">
                <div class="section-header">
                    <div class="section-title">–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã</div>
                </div>
                <div class="chat-list" id="globalChats">
                    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã -->
                </div>

                <div class="section-header">
                    <div class="section-title">–ì—Ä—É–ø–ø—ã</div>
                    <button class="add-btn" id="addGroupBtn">+</button>
                </div>
                <div class="chat-list" id="groupChats">
                    <!-- –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã -->
                </div>

                <div class="section-header">
                    <div class="section-title">–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
                </div>
                <div class="chat-list" id="privateChats">
                    <!-- –õ–∏—á–Ω—ã–µ —á–∞—Ç—ã -->
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-info-main">
                    <div class="chat-avatar" id="currentChatAvatar">üí¨</div>
                    <div>
                        <div class="chat-title" id="currentRoom">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        <div class="chat-status">
                            <span id="onlineCount">0 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                            <span id="typingIndicator" style="display: none;"> - –ø–µ—á–∞—Ç–∞–µ—Ç...</span>
                        </div>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="control-btn" id="voiceCallBtn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫">üìû</button>
                    <button class="control-btn" id="videoCallBtn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫">üìπ</button>
                    <button class="control-btn" id="screenShareBtn" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">üñ•Ô∏è</button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="system-message">
                    <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NoknowGram PRO!</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</p>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <div class="input-actions">
                        <input type="file" id="fileInput" style="display: none;" multiple>
                        <button class="icon-btn" onclick="document.getElementById('fileInput').click()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                            üìé
                        </button>
                    </div>
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                        rows="1"
                        disabled
                    ></textarea>
                    <button class="send-btn" id="sendBtn" disabled>‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É</div>
                <div class="modal-subtitle">–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</div>
            </div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                <input type="text" class="form-input" id="groupNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
            </div>
            <div class="form-group">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                <div class="user-selector" id="userSelector">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelGroupBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="confirmGroupBtn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ -->
    <div class="call-window" id="callWindow">
        <div class="call-header">
            <h2 id="callTitle">–ó–≤–æ–Ω–æ–∫</h2>
            <div id="callStatus">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...</div>
        </div>
        <div class="call-main">
            <div class="video-container">
                <video id="remoteVideo" autoplay playsinline class="remote-video"></video>
                <div class="video-placeholder" id="videoPlaceholder">
                    üìπ –û–∂–∏–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ...
                </div>
                <div class="call-info">
                    <div id="callTimer">00:00</div>
                    <div id="callWith"></div>
                </div>
                <div class="local-video">
                    <video id="localVideo" autoplay playsinline muted></video>
                </div>
            </div>
        </div>
        <div class="call-controls-bottom">
            <button class="call-control-btn" id="callMuteBtn">üé§</button>
            <button class="call-control-btn" id="callVideoBtn">üìπ</button>
            <button class="call-control-btn screen-share" id="screenShareCallBtn">üñ•Ô∏è</button>
            <button class="call-control-btn end-call" id="callEndBtn">üìû</button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞ -->
    <div class="incoming-call-modal" id="incomingCallModal">
        <div class="incoming-call-content">
            <div class="avatar pulse" style="width: 80px; height: 80px; font-size: 2em; margin: 0 auto 20px;" id="callerAvatar">U</div>
            <h2 id="callerName">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</h2>
            <p id="callType">–ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫</p>
            <div class="incoming-call-buttons">
                <button class="accept-call-btn" id="acceptCallBtn">üìû –ü—Ä–∏–Ω—è—Ç—å</button>
                <button class="reject-call-btn" id="rejectCallBtn">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        class ChatApp {
            constructor() {
                this.currentUser = null;
                this.currentRoom = null;
                this.socket = null;
                this.typingTimer = null;
                this.typingUsers = new Set();
                
                // WebRTC –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                this.peerConnection = null;
                this.localStream = null;
                this.remoteStream = null;
                this.isInCall = false;
                this.isCaller = false;
                this.callStartTime = null;
                this.callTimerInterval = null;
                this.currentCaller = null;
                this.currentCallType = null;
                this.currentCallId = null;
                this.targetUser = null;
                this.callSound = null;
                this.isScreenSharing = false;
                this.remoteOffer = null;
                
                // –î–∞–Ω–Ω—ã–µ
                this.onlineUsers = [];
                this.userGroups = [];
                this.selectedUsers = new Set();
                
                this.init();
            }

            init() {
                this.checkAuth();
                this.setupElements();
                this.connectSocket();
                this.bindEvents();
                this.loadGlobalChats();
            }

            checkAuth() {
                const userData = localStorage.getItem('currentUser');
                if (!userData) {
                    window.location.href = '/';
                    return;
                }
                this.currentUser = JSON.parse(userData);
                this.displayUserInfo();
            }

            displayUserInfo() {
                document.getElementById('userName').textContent = this.currentUser.username;
                document.getElementById('userAvatar').textContent = this.currentUser.username.charAt(0).toUpperCase();
            }

            setupElements() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                this.messageInput = document.getElementById('messageInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.messagesContainer = document.getElementById('messagesContainer');
                this.currentRoomElement = document.getElementById('currentRoom');
                this.onlineCount = document.getElementById('onlineCount');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.fileInput = document.getElementById('fileInput');
                this.logoutBtn = document.getElementById('logoutBtn');
                
                // –ßats
                this.globalChats = document.getElementById('globalChats');
                this.groupChats = document.getElementById('groupChats');
                this.privateChats = document.getElementById('privateChats');
                
                // –ó–≤–æ–Ω–∫–∏
                this.callWindow = document.getElementById('callWindow');
                this.callTitle = document.getElementById('callTitle');
                this.callStatus = document.getElementById('callStatus');
                this.remoteVideo = document.getElementById('remoteVideo');
                this.localVideo = document.getElementById('localVideo');
                this.videoPlaceholder = document.getElementById('videoPlaceholder');
                this.callTimer = document.getElementById('callTimer');
                this.callWith = document.getElementById('callWith');
                this.callMuteBtn = document.getElementById('callMuteBtn');
                this.callVideoBtn = document.getElementById('callVideoBtn');
                this.callEndBtn = document.getElementById('callEndBtn');
                this.voiceCallBtn = document.getElementById('voiceCallBtn');
                this.videoCallBtn = document.getElementById('videoCallBtn');
                this.screenShareBtn = document.getElementById('screenShareBtn');
                this.screenShareCallBtn = document.getElementById('screenShareCallBtn');
                
                // –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫
                this.incomingCallModal = document.getElementById('incomingCallModal');
                this.callerName = document.getElementById('callerName');
                this.callerAvatar = document.getElementById('callerAvatar');
                this.callType = document.getElementById('callType');
                this.acceptCallBtn = document.getElementById('acceptCallBtn');
                this.rejectCallBtn = document.getElementById('rejectCallBtn');
                
                // –ì—Ä—É–ø–ø—ã
                this.createGroupModal = document.getElementById('createGroupModal');
                this.createGroupBtn = document.getElementById('createGroupBtn');
                this.addGroupBtn = document.getElementById('addGroupBtn');
                this.groupNameInput = document.getElementById('groupNameInput');
                this.userSelector = document.getElementById('userSelector');
                this.cancelGroupBtn = document.getElementById('cancelGroupBtn');
                this.confirmGroupBtn = document.getElementById('confirmGroupBtn');
            }

            connectSocket() {
                this.socket = io();

                this.socket.on('connect', () => {
                    console.log('Connected to server');
                    this.socket.emit('user_join', { username: this.currentUser.username });
                });

                this.socket.on('user_joined', (data) => {
                    this.addSystemMessage(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${data.username} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è`);
                });

                this.socket.on('user_left', (data) => {
                    this.addSystemMessage(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${data.username} –≤—ã—à–µ–ª`);
                });

                this.socket.on('online_users', (data) => {
                    this.onlineUsers = data.users;
                    this.updateOnlineUsers();
                    this.updateUserSelector();
                });

                this.socket.on('user_groups', (data) => {
                    this.userGroups = data.groups;
                    this.updateGroupChats();
                });

                this.socket.on('new_message', (data) => {
                    if (data.room === this.currentRoom) {
                        this.addMessage(data.username, data.text, data.username === this.currentUser.username, 
                                      data.timestamp, data.file, data.type, data.file_info);
                    }
                });

                this.socket.on('user_typing', (data) => {
                    if (data.room === this.currentRoom) {
                        this.handleTypingIndicator(data.username, data.is_typing);
                    }
                });

                // –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫
                this.socket.on('incoming_call', (data) => {
                    this.handleIncomingCall(data.caller, data.type, data.call_id, data.is_group, data.group_name);
                });

                this.socket.on('call_accepted', (data) => {
                    this.handleCallAccepted(data.accepted_by, data.call_id);
                });

                this.socket.on('call_rejected', (data) => {
                    this.handleCallRejected(data.rejected_by);
                });

                this.socket.on('call_ended', (data) => {
                    this.handleCallEnded(data.ended_by);
                });

                // WebRTC signaling
                this.socket.on('webrtc_offer', (data) => {
                    this.handleWebRTCOffer(data);
                });

                this.socket.on('webrtc_answer', (data) => {
                    this.handleWebRTCAnswer(data);
                });

                this.socket.on('webrtc_ice_candidate', (data) => {
                    this.handleWebRTCIceCandidate(data);
                });

                this.socket.on('webrtc_call_ended', (data) => {
                    if (this.currentCallId === data.call_id) {
                        this.addSystemMessage('üìû –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –∑–∞–≤–µ—Ä—à–∏–ª –∑–≤–æ–Ω–æ–∫');
                        this.endCall();
                    }
                });
            }

            bindEvents() {
                // –°–æ–æ–±—â–µ–Ω–∏—è
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                this.messageInput.addEventListener('input', () => {
                    this.handleTyping();
                    this.autoResizeTextarea();
                });

                // –§–∞–π–ª—ã
                this.fileInput.addEventListener('change', (e) => {
                    Array.from(e.target.files).forEach(file => this.uploadFile(file));
                });

                // –ó–≤–æ–Ω–∫–∏
                this.voiceCallBtn.addEventListener('click', () => this.startCall('voice'));
                this.videoCallBtn.addEventListener('click', () => this.startCall('video'));
                this.screenShareBtn.addEventListener('click', () => this.toggleScreenShare());
                this.screenShareCallBtn.addEventListener('click', () => this.toggleScreenShare());
                this.callMuteBtn.addEventListener('click', () => this.toggleMute());
                this.callVideoBtn.addEventListener('click', () => this.toggleVideo());
                this.callEndBtn.addEventListener('click', () => this.endCall());
                this.acceptCallBtn.addEventListener('click', () => this.acceptCall());
                this.rejectCallBtn.addEventListener('click', () => this.rejectCall());

                // –ì—Ä—É–ø–ø—ã
                this.createGroupBtn.addEventListener('click', () => this.showCreateGroupModal());
                this.addGroupBtn.addEventListener('click', () => this.showCreateGroupModal());
                this.cancelGroupBtn.addEventListener('click', () => this.hideCreateGroupModal());
                this.confirmGroupBtn.addEventListener('click', () => this.createGroup());

                // –í—ã—Ö–æ–¥
                this.logoutBtn.addEventListener('click', () => {
                    this.endCall();
                    localStorage.removeItem('currentUser');
                    window.location.href = '/';
                });
            }

            // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ß–ê–¢–´
            loadGlobalChats() {
                const globalChats = [
                    { id: 'general', name: 'üåç –ì–ª–∞–≤–Ω—ã–π —á–∞—Ç', avatar: 'üåç', lastMessage: '–û–±—â–∏–π —á–∞—Ç –¥–ª—è –≤—Å–µ—Ö' },
                    { id: 'random', name: 'üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', avatar: 'üéÆ', lastMessage: '–ò–≥—Ä—ã, –º–µ–º—ã –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è' },
                    { id: 'help', name: '‚ùì –ü–æ–º–æ—â—å', avatar: '‚ùì', lastMessage: '–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã' }
                ];

                this.globalChats.innerHTML = '';
                globalChats.forEach(chat => {
                    const chatItem = this.createChatItem(chat);
                    this.globalChats.appendChild(chatItem);
                });
            }

            // –ì–†–£–ü–ü–´
            showCreateGroupModal() {
                this.createGroupModal.classList.add('active');
                this.groupNameInput.value = '';
                this.selectedUsers.clear();
                this.updateUserSelector();
            }

            hideCreateGroupModal() {
                this.createGroupModal.classList.remove('active');
            }

            updateUserSelector() {
                this.userSelector.innerHTML = '';
                
                this.onlineUsers.forEach(username => {
                    if (username !== this.currentUser.username) {
                        const userOption = document.createElement('div');
                        userOption.className = 'user-option';
                        userOption.innerHTML = `
                            <div class="avatar" style="width: 30px; height: 30px; font-size: 0.9em;">
                                ${username.charAt(0).toUpperCase()}
                            </div>
                            <div>${username}</div>
                            <div class="online-indicator"></div>
                        `;
                        
                        userOption.addEventListener('click', () => {
                            userOption.classList.toggle('selected');
                            if (userOption.classList.contains('selected')) {
                                this.selectedUsers.add(username);
                            } else {
                                this.selectedUsers.delete(username);
                            }
                        });
                        
                        this.userSelector.appendChild(userOption);
                    }
                });
            }

            async createGroup() {
                const groupName = this.groupNameInput.value.trim();
                if (!groupName) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                    return;
                }

                if (this.selectedUsers.size === 0) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞');
                    return;
                }

                try {
                    const response = await fetch('/api/groups/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: groupName,
                            creator: this.currentUser.username,
                            members: Array.from(this.selectedUsers)
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        this.hideCreateGroupModal();
                        this.userGroups.push(data.group);
                        this.updateGroupChats();
                        this.addSystemMessage(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≥—Ä—É–ø–ø–∞ "${groupName}"`);
                    } else {
                        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã: ' + data.message);
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã');
                }
            }

            updateGroupChats() {
                this.groupChats.innerHTML = '';
                
                this.userGroups.forEach(group => {
                    const chatItem = this.createChatItem({
                        id: group.id,
                        name: `üë• ${group.name}`,
                        avatar: 'üë•',
                        lastMessage: `${group.members.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`
                    });
                    this.groupChats.appendChild(chatItem);
                });
            }

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–ù–õ–ê–ô–ù –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
            updateOnlineUsers() {
                this.privateChats.innerHTML = '';
                
                this.onlineUsers.forEach(username => {
                    if (username !== this.currentUser.username) {
                        const chatItem = this.createChatItem({
                            id: `private_${[this.currentUser.username, username].sort().join('_')}`,
                            name: username,
                            avatar: 'üí¨',
                            lastMessage: '–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
                            isPrivate: true
                        });
                        this.privateChats.appendChild(chatItem);
                    }
                });
            }

            // –°–û–ó–î–ê–ù–ò–ï –≠–õ–ï–ú–ï–ù–¢–ê –ß–ê–¢–ê
            createChatItem(chat) {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.dataset.room = chat.id;
                
                chatItem.innerHTML = `
                    <div class="chat-avatar">${chat.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-name">${chat.name}</div>
                        <div class="chat-last-message">${chat.lastMessage}</div>
                    </div>
                    ${chat.isPrivate ? '<div class="online-indicator"></div>' : ''}
                `;
                
                chatItem.addEventListener('click', () => {
                    this.switchRoom(chat.id, chat.name, chat.avatar);
                });
                
                return chatItem;
            }

            // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ö–û–ú–ù–ê–¢–´
            async switchRoom(roomId, roomName, roomAvatar) {
                document.querySelectorAll('.chat-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-room="${roomId}"]`).classList.add('active');
                
                this.currentRoom = roomId;
                this.currentRoomElement.textContent = roomName;
                document.getElementById('currentChatAvatar').textContent = roomAvatar;
                
                // –í–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                this.messageInput.disabled = false;
                this.sendBtn.disabled = false;
                this.messageInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                await this.loadRoomMessages();
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
                this.socket.emit('join_room', { room: roomId });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                this.updateRoomStatus();
            }

            updateRoomStatus() {
                if (this.currentRoom.startsWith('group_')) {
                    const group = this.userGroups.find(g => g.id === this.currentRoom);
                    if (group) {
                        this.onlineCount.textContent = `${group.members.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
                    }
                } else if (this.currentRoom.startsWith('private_')) {
                    this.onlineCount.textContent = '–ª–∏—á–Ω—ã–π —á–∞—Ç';
                } else {
                    this.onlineCount.textContent = `${this.onlineUsers.length} –æ–Ω–ª–∞–π–Ω`;
                }
            }

            // –ó–ê–ì–†–£–ó–ö–ê –°–û–û–ë–©–ï–ù–ò–ô
            async loadRoomMessages() {
                try {
                    const response = await fetch(`/api/messages/${this.currentRoom}`);
                    const data = await response.json();
                    
                    this.messagesContainer.innerHTML = '';
                    
                    if (data.messages.length === 0) {
                        this.addSystemMessage('–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ –≤ —ç—Ç–æ–º —á–∞—Ç–µ');
                    } else {
                        data.messages.forEach(msg => {
                            this.addMessage(msg.username, msg.text, msg.username === this.currentUser.username, 
                                          msg.timestamp, msg.file, msg.type, msg.file_info);
                        });
                    }
                } catch (error) {
                    console.error('Error loading messages:', error);
                    this.addSystemMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π');
                }
            }

            // –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô
            sendMessage() {
                const text = this.messageInput.value.trim();
                if (!text) return;

                this.socket.emit('send_message', {
                    username: this.currentUser.username,
                    text: text,
                    room: this.currentRoom,
                    type: 'text'
                });

                this.messageInput.value = '';
                this.autoResizeTextarea();
                this.stopTyping();
            }

            // –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í
            async uploadFile(file) {
                if (!file) return;

                const formData = new FormData();
                formData.append('file', file);

                try {
                    this.addSystemMessage('üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...');

                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.socket.emit('send_message', {
                            username: this.currentUser.username,
                            text: data.original_name,
                            file: data.url,
                            file_info: {
                                type: data.type,
                                size: data.size,
                                extension: data.extension
                            },
                            room: this.currentRoom,
                            type: 'file'
                        });
                    } else {
                        this.addSystemMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + data.message);
                    }
                } catch (error) {
                    this.addSystemMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                }

                this.fileInput.value = '';
            }

            // WebRTC –†–ï–ê–õ–¨–ù–´–ï –ó–í–û–ù–ö–ò
            async startCall(type) {
                if (!this.currentRoom) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –∑–≤–æ–Ω–∫–∞');
                    return;
                }

                if (this.isInCall) {
                    alert('–í—ã —É–∂–µ –≤ –∑–≤–æ–Ω–∫–µ');
                    return;
                }

                try {
                    this.currentCallType = type;
                    this.isCaller = true;
                    this.currentCallId = 'call_' + Date.now();

                    // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫
                    await this.getUserMedia();

                    let target = this.currentRoom;
                    if (this.currentRoom.startsWith('private_')) {
                        const users = this.currentRoom.replace('private_', '').split('_');
                        target = users.find(user => user !== this.currentUser.username);
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –∑–≤–æ–Ω–∫–∞
                    this.showCallWindow(`–ó–≤–æ–Ω–æ–∫ ${this.getRoomName(this.currentRoom)}`, '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...');
                    this.callWith.textContent = `–í: ${this.getRoomName(this.currentRoom)}`;

                    // –°–æ–∑–¥–∞–µ–º WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                    await this.createPeerConnection();

                    // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ñ—Ñ–µ—Ä
                    const offer = await this.peerConnection.createOffer();
                    await this.peerConnection.setLocalDescription(offer);

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–≤–æ–Ω–æ–∫
                    this.socket.emit('start_call', {
                        username: this.currentUser.username,
                        target: target,
                        type: type,
                        call_id: this.currentCallId
                    });

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º WebRTC –æ—Ñ—Ñ–µ—Ä
                    this.socket.emit('webrtc_offer', {
                        offer: offer,
                        caller: this.currentUser.username,
                        target: target,
                        call_id: this.currentCallId
                    });

                    // –¢–∞–π–º–∞—É—Ç
                    this.callTimeout = setTimeout(() => {
                        if (this.isInCall && this.isCaller) {
                            this.addSystemMessage('‚ùå –ù–∏–∫—Ç–æ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –∑–≤–æ–Ω–æ–∫');
                            this.endCall();
                        }
                    }, 30000);

                } catch (error) {
                    console.error('Error starting call:', error);
                    this.addSystemMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∑–≤–æ–Ω–∫–∞');
                    this.endCall();
                }
            }

            async getUserMedia() {
                try {
                    const constraints = {
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true
                        },
                        video: this.currentCallType === 'video' ? {
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } : false
                    };

                    this.localStream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                    if (this.localVideo) {
                        this.localVideo.srcObject = this.localStream;
                    }

                    console.log('Got media stream with tracks:', this.localStream.getTracks());
                    return this.localStream;
                } catch (error) {
                    console.error('Error accessing media devices:', error);
                    this.addSystemMessage('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
                    throw error;
                }
            }

            async createPeerConnection() {
                try {
                    const configuration = {
                        iceServers: [
                            { urls: 'stun:stun.l.google.com:19302' },
                            { urls: 'stun:stun1.l.google.com:19302' },
                            { urls: 'stun:stun2.l.google.com:19302' }
                        ]
                    };

                    this.peerConnection = new RTCPeerConnection(configuration);

                    // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
                    if (this.localStream) {
                        this.localStream.getTracks().forEach(track => {
                            console.log('Adding track:', track.kind, track.enabled);
                            this.peerConnection.addTrack(track, this.localStream);
                        });
                    }

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
                    this.peerConnection.ontrack = (event) => {
                        console.log('Received remote stream with tracks:', event.streams[0].getTracks());
                        
                        if (this.remoteVideo) {
                            this.remoteVideo.srcObject = event.streams[0];
                            this.videoPlaceholder.style.display = 'none';
                            
                            // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
                            this.remoteVideo.play().catch(e => {
                                console.log('Auto-play prevented:', e);
                            });
                        }
                    };

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                    this.peerConnection.onicecandidate = (event) => {
                        if (event.candidate) {
                            let target = this.currentRoom;
                            if (this.currentRoom.startsWith('private_')) {
                                const users = this.currentRoom.replace('private_', '').split('_');
                                target = users.find(user => user !== this.currentUser.username);
                            }

                            this.socket.emit('webrtc_ice_candidate', {
                                candidate: event.candidate,
                                call_id: this.currentCallId,
                                target_user: target,
                                caller: this.currentUser.username
                            });
                        }
                    };

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                    this.peerConnection.onconnectionstatechange = () => {
                        console.log('Connection state:', this.peerConnection.connectionState);
                        switch (this.peerConnection.connectionState) {
                            case 'connected':
                                this.callStatus.textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                                this.addSystemMessage('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –ì–æ–≤–æ—Ä–∏—Ç–µ —Å–µ–π—á–∞—Å');
                                break;
                            case 'disconnected':
                            case 'failed':
                                this.addSystemMessage('‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ');
                                this.endCall();
                                break;
                        }
                    };

                } catch (error) {
                    console.error('Error creating peer connection:', error);
                    throw error;
                }
            }

            async handleIncomingCall(caller, type, call_id, is_group = false, group_name = '') {
                if (this.isInCall) {
                    this.socket.emit('reject_call', {
                        username: this.currentUser.username,
                        caller: caller,
                        call_id: call_id
                    });
                    return;
                }

                this.currentCaller = caller;
                this.currentCallType = type;
                this.currentCallId = call_id;

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞
                this.playCallSound('incoming');

                this.callerName.textContent = `–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –æ—Ç ${caller}`;
                this.callerAvatar.textContent = caller.charAt(0).toUpperCase();
                this.callType.textContent = type === 'voice' ? '–ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫' : '–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫';
                this.incomingCallModal.classList.add('active');
            }

            async acceptCall() {
                try {
                    this.incomingCallModal.classList.remove('active');
                    this.isInCall = true;
                    this.stopCallSound();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫
                    await this.getUserMedia();
                    
                    // –°–æ–∑–¥–∞–µ–º WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                    await this.createPeerConnection();

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –∑–≤–æ–Ω–∫–∞
                    this.showCallWindow(`–ó–≤–æ–Ω–æ–∫ —Å ${this.currentCaller}`, '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...');
                    this.callWith.textContent = `–°: ${this.currentCaller}`;
                    this.startCallTimer();

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ—Ñ—Ñ–µ—Ä)
                    if (this.remoteOffer) {
                        await this.peerConnection.setRemoteDescription(this.remoteOffer);
                        
                        // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
                        const answer = await this.peerConnection.createAnswer();
                        await this.peerConnection.setLocalDescription(answer);

                        this.socket.emit('webrtc_answer', {
                            answer: answer,
                            caller: this.currentCaller,
                            call_id: this.currentCallId
                        });
                    }

                    // –£–≤–µ–¥–æ–º–ª—è–µ–º –∑–≤–æ–Ω—è—â–µ–≥–æ
                    this.socket.emit('accept_call', {
                        username: this.currentUser.username,
                        caller: this.currentCaller,
                        call_id: this.currentCallId
                    });

                    this.addSystemMessage(`üìû –í—ã –ø—Ä–∏–Ω—è–ª–∏ –∑–≤–æ–Ω–æ–∫ –æ—Ç ${this.currentCaller}`);
                    this.addSystemMessage('üé§ –ì–æ–≤–æ—Ä–∏—Ç–µ - –≤–∞—Å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª—ã—à–Ω–æ');

                } catch (error) {
                    console.error('Error accepting call:', error);
                    this.addSystemMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–≤–æ–Ω–∫–∞');
                    this.endCall();
                }
            }

            rejectCall() {
                this.incomingCallModal.classList.remove('active');
                this.stopCallSound();
                
                this.socket.emit('reject_call', {
                    username: this.currentUser.username,
                    caller: this.currentCaller,
                    call_id: this.currentCallId
                });

                this.addSystemMessage(`‚ùå –í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –∑–≤–æ–Ω–æ–∫ –æ—Ç ${this.currentCaller}`);
                this.resetCallData();
            }

            // WebRTC –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            handleWebRTCOffer(data) {
                if (!this.currentCallId || this.currentCallId === data.call_id) {
                    this.remoteOffer = new RTCSessionDescription(data.offer);
                    
                    // –ï—Å–ª–∏ –º—ã —É–∂–µ –ø—Ä–∏–Ω—è–ª–∏ –∑–≤–æ–Ω–æ–∫, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ñ—Ñ–µ—Ä
                    if (this.isInCall && this.peerConnection) {
                        this.peerConnection.setRemoteDescription(this.remoteOffer)
                            .then(() => this.peerConnection.createAnswer())
                            .then(answer => {
                                this.peerConnection.setLocalDescription(answer);
                                this.socket.emit('webrtc_answer', {
                                    answer: answer,
                                    caller: data.caller,
                                    call_id: this.currentCallId
                                });
                            })
                            .catch(error => {
                                console.error('Error handling offer:', error);
                            });
                    }
                }
            }

            handleWebRTCAnswer(data) {
                if (this.currentCallId === data.call_id && this.peerConnection) {
                    const answer = new RTCSessionDescription(data.answer);
                    this.peerConnection.setRemoteDescription(answer)
                        .catch(error => {
                            console.error('Error setting remote description:', error);
                        });
                }
            }

            handleWebRTCIceCandidate(data) {
                if (this.currentCallId === data.call_id && this.peerConnection) {
                    this.peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate))
                        .catch(error => {
                            console.error('Error adding ICE candidate:', error);
                        });
                }
            }

            // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞
            async toggleScreenShare() {
                if (!this.isInCall) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—á–Ω–∏—Ç–µ –∑–≤–æ–Ω–æ–∫');
                    return;
                }

                try {
                    if (!this.isScreenSharing) {
                        const screenStream = await navigator.mediaDevices.getDisplayMedia({
                            video: true,
                            audio: true
                        });
                        
                        const videoTrack = screenStream.getVideoTracks()[0];
                        const sender = this.peerConnection.getSenders().find(s => 
                            s.track && s.track.kind === 'video'
                        );
                        
                        if (sender) {
                            await sender.replaceTrack(videoTrack);
                        }
                        
                        videoTrack.onended = () => {
                            this.toggleScreenShare();
                        };
                        
                        this.isScreenSharing = true;
                        this.addSystemMessage('üñ•Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –Ω–∞—á–∞—Ç–∞');
                        
                    } else {
                        const videoTrack = this.localStream.getVideoTracks()[0];
                        const sender = this.peerConnection.getSenders().find(s => 
                            s.track && s.track.kind === 'video'
                        );
                        
                        if (sender && videoTrack) {
                            await sender.replaceTrack(videoTrack);
                        }
                        
                        this.isScreenSharing = false;
                        this.addSystemMessage('üñ•Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                    }
                } catch (error) {
                    console.error('Error toggling screen share:', error);
                    this.addSystemMessage('‚ùå –û—à–∏–±–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞');
                }
            }

            // –ó–í–£–ö –ó–í–û–ù–ö–ê
            playCallSound(type) {
                this.stopCallSound();
                
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    if (type === 'incoming') {
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.5);
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + 1.0);
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime + 1.5);
                        
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 4);
                    } else {
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        oscillator.start();
                        
                        this.callSound = { oscillator, context: audioContext };
                    }
                } catch (error) {
                    console.error('Error playing call sound:', error);
                }
            }

            stopCallSound() {
                if (this.callSound) {
                    try {
                        if (this.callSound.oscillator) this.callSound.oscillator.stop();
                        if (this.callSound.context) this.callSound.context.close();
                    } catch (error) {
                        console.error('Error stopping call sound:', error);
                    }
                    this.callSound = null;
                }
            }

            showCallWindow(title, status) {
                this.callTitle.textContent = title;
                this.callStatus.textContent = status;
                this.callWindow.classList.add('active');
                this.videoPlaceholder.style.display = 'flex';
                this.isInCall = true;
            }

            startCallTimer() {
                this.callStartTime = new Date();
                this.updateCallTimer();
                this.callTimerInterval = setInterval(() => this.updateCallTimer(), 1000);
            }

            updateCallTimer() {
                if (this.callStartTime) {
                    const now = new Date();
                    const diff = Math.floor((now - this.callStartTime) / 1000);
                    const minutes = Math.floor(diff / 60);
                    const seconds = diff % 60;
                    this.callTimer.textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            toggleMute() {
                const isMuted = this.callMuteBtn.classList.toggle('mute');
                this.addSystemMessage(isMuted ? 'üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω' : 'üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω');
                
                if (this.localStream) {
                    const audioTracks = this.localStream.getAudioTracks();
                    audioTracks.forEach(track => {
                        track.enabled = !isMuted;
                    });
                }
            }

            toggleVideo() {
                const isVideoOff = this.callVideoBtn.classList.toggle('video-off');
                this.addSystemMessage(isVideoOff ? 'üìπ –ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞' : 'üìπ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
                
                if (this.localStream) {
                    const videoTracks = this.localStream.getVideoTracks();
                    videoTracks.forEach(track => {
                        track.enabled = !isVideoOff;
                    });
                }
            }

            endCall() {
                this.isInCall = false;
                this.isCaller = false;
                this.isScreenSharing = false;
                this.stopCallSound();
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∏
                if (this.localStream) {
                    this.localStream.getTracks().forEach(track => track.stop());
                    this.localStream = null;
                }
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                if (this.peerConnection) {
                    this.peerConnection.close();
                    this.peerConnection = null;
                }
                
                if (this.callTimerInterval) {
                    clearInterval(this.callTimerInterval);
                    this.callTimerInterval = null;
                }
                
                if (this.callTimeout) {
                    clearTimeout(this.callTimeout);
                    this.callTimeout = null;
                }

                this.callWindow.classList.remove('active');
                this.incomingCallModal.classList.remove('active');

                // –£–≤–µ–¥–æ–º–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–≤–æ–Ω–∫–∞
                if (this.currentCallId) {
                    this.socket.emit('end_call', {
                        username: this.currentUser.username,
                        call_id: this.currentCallId
                    });
                    
                    this.socket.emit('webrtc_end_call', {
                        call_id: this.currentCallId
                    });
                }

                this.resetCallData();
                this.addSystemMessage('üìû –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
            }

            resetCallData() {
                this.currentCaller = null;
                this.targetUser = null;
                this.currentCallId = null;
                this.currentCallType = null;
                this.remoteOffer = null;
            }

            handleCallAccepted(acceptedBy, call_id) {
                if (this.isCaller && this.currentCallId === call_id) {
                    this.stopCallSound();
                    this.callStatus.textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                    this.startCallTimer();
                    this.addSystemMessage(`‚úÖ ${acceptedBy} –ø—Ä–∏–Ω—è–ª –∑–≤–æ–Ω–æ–∫`);
                    
                    if (this.callTimeout) {
                        clearTimeout(this.callTimeout);
                        this.callTimeout = null;
                    }
                }
            }

            handleCallRejected(rejectedBy) {
                if (this.isCaller) {
                    this.stopCallSound();
                    this.addSystemMessage(`‚ùå ${rejectedBy} –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–≤–æ–Ω–æ–∫`);
                    this.endCall();
                }
            }

            handleCallEnded(endedBy) {
                if (this.isInCall) {
                    this.stopCallSound();
                    this.addSystemMessage(`üìû ${endedBy} –∑–∞–≤–µ—Ä—à–∏–ª –∑–≤–æ–Ω–æ–∫`);
                    this.endCall();
                }
            }

            getRoomName(roomId) {
                if (roomId.startsWith('private_')) {
                    const users = roomId.replace('private_', '').split('_');
                    return users.find(user => user !== this.currentUser.username);
                }
                if (roomId.startsWith('group_')) {
                    const group = this.userGroups.find(g => g.id === roomId);
                    return group ? group.name : '–ì—Ä—É–ø–ø–∞';
                }
                
                const rooms = {
                    'general': '–ì–ª–∞–≤–Ω—ã–π —á–∞—Ç',
                    'random': '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', 
                    'help': '–ü–æ–º–æ—â—å'
                };
                return rooms[roomId] || roomId;
            }

            // –°–û–û–ë–©–ï–ù–ò–Ø
            addMessage(sender, text, isOwn, timestamp, file = null, type = 'text', fileInfo = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOwn ? 'own' : ''} ${type === 'file' ? 'file-message' : ''}`;
                
                const time = new Date(timestamp).toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', minute: '2-digit' 
                });

                let content = this.escapeHtml(text);
                
                if (type === 'file' && file) {
                    content = this.createFileMessage(text, file, fileInfo);
                }

                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span class="sender-name">${sender}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div>${content}</div>
                `;

                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            createFileMessage(filename, fileUrl, fileInfo) {
                const fileType = fileInfo?.type || 'other';
                const fileSize = this.formatFileSize(fileInfo?.size || 0);
                const fileExt = fileInfo?.extension || filename.split('.').pop();
                
                const icons = {
                    images: 'üñºÔ∏è', videos: 'üé¨', audio: 'üéµ', 
                    documents: 'üìÑ', archives: 'üì¶', other: 'üìé'
                };
                
                let preview = '';
                if (fileType === 'images') {
                    preview = `<img src="${fileUrl}" class="image-preview" alt="${filename}">`;
                }
                
                return `
                    <div class="file-preview">
                        <div class="file-icon ${fileType}">${icons[fileType]}</div>
                        <div class="file-info">
                            <div class="file-name">${filename}</div>
                            <div class="file-size">${fileSize} ‚Ä¢ ${fileExt.toUpperCase()}</div>
                        </div>
                    </div>
                    ${preview}
                    <div class="file-actions">
                        <button class="file-action-btn" onclick="window.open('${fileUrl}', '_blank')">
                            üìÅ –û—Ç–∫—Ä—ã—Ç—å
                        </button>
                        <button class="file-action-btn" onclick="downloadFile('${fileUrl}', '${filename}')">
                            üíæ –°–∫–∞—á–∞—Ç—å
                        </button>
                    </div>
                `;
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            addSystemMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'system-message';
                messageDiv.textContent = text;
                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            handleTyping() {
                if (!this.currentRoom) return;
                
                this.socket.emit('typing', {
                    username: this.currentUser.username,
                    is_typing: true,
                    room: this.currentRoom
                });

                clearTimeout(this.typingTimer);
                this.typingTimer = setTimeout(() => this.stopTyping(), 1000);
            }

            stopTyping() {
                if (!this.currentRoom) return;
                
                this.socket.emit('typing', {
                    username: this.currentUser.username,
                    is_typing: false,
                    room: this.currentRoom
                });
            }

            handleTypingIndicator(username, isTyping) {
                if (isTyping) {
                    this.typingUsers.add(username);
                } else {
                    this.typingUsers.delete(username);
                }
                this.updateTypingIndicator();
            }

            updateTypingIndicator() {
                if (this.typingUsers.size > 0) {
                    const users = Array.from(this.typingUsers);
                    let text = users.length === 1 ? `${users[0]} –ø–µ—á–∞—Ç–∞–µ—Ç...` : `${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—á–∞—Ç–∞—é—Ç...`;
                    this.typingIndicator.textContent = ` - ${text}`;
                    this.typingIndicator.style.display = 'inline';
                } else {
                    this.typingIndicator.style.display = 'none';
                }
            }

            autoResizeTextarea() {
                this.messageInput.style.height = 'auto';
                this.messageInput.style.height = Math.min(this.messageInput.scrollHeight, 120) + 'px';
            }

            scrollToBottom() {
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const chatApp = new ChatApp();
    </script>
</body>
</html>
